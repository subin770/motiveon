<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.motiveon.mybatis.mappers.AccountMapper">

    <!-- 계정 목록 조회 -->
    <select id="selectAccounts" resultType="com.motiveon.dto.EmployeeAccountVO">
        SELECT
            h.ontime AS loginTime,
            d.name AS deptName,         <!-- 부서명 -->
            e.name AS name,
            p.ppsname AS ppsName,      <!-- 직위명 -->
            e.job AS job,              <!-- 직책 -->
            e.joindate AS joinDate,
            e.leavedate AS leaveDate,
            e.authorities AS role,
            e.enabled AS enabled,
            e.phone AS phone,
            e.eno AS empNo
        FROM employee e
        LEFT JOIN department d ON e.dno = d.dno
        LEFT JOIN postposition p ON e.ppscode = p.ppscode
        LEFT JOIN hr h ON e.eno = h.eno
    </select>

    <!-- 계정 상세 조회 -->
    <select id="selectAccountById" parameterType="Integer"
            resultType="com.motiveon.dto.EmployeeAccountVO">
        SELECT
            e.eno AS empNo,
            h.ontime AS loginTime,
            d.name AS deptName,
            e.name AS name,
            p.ppsname AS ppsName,
            e.job AS job,
            e.joindate AS joinDate,
            e.leavedate AS leaveDate,
            e.authorities AS role,
            e.enabled AS enabled,
            e.phone AS phone
        FROM employee e
        LEFT JOIN department d ON e.dno = d.dno
        LEFT JOIN postposition p ON e.ppscode = p.ppscode
        LEFT JOIN hr h ON e.eno = h.eno
        WHERE e.eno = #{empNo, jdbcType=INTEGER}
    </select>

    <!-- 새 계정 등록 -->
    <insert id="insertAccount" parameterType="com.motiveon.dto.EmployeeAccountVO">
        INSERT INTO employee (
            eno, name, dno, ppscode, job, duty, authorities, enabled, phone, joindate
        ) VALUES (
            #{empNo, jdbcType=INTEGER},
            #{name, jdbcType=VARCHAR},
            #{dno, jdbcType=INTEGER},        <!-- 부서코드 -->
            #{ppscode, jdbcType=INTEGER},    <!-- 직위코드 -->
            #{job, jdbcType=VARCHAR},
            #{role, jdbcType=VARCHAR},
            #{enabled, jdbcType=INTEGER},
            #{phone, jdbcType=VARCHAR},
            #{joinDate, jdbcType=DATE}
        )
    </insert>

     <!-- 계정 수정 -->
    <update id="updateAccount" parameterType="com.motiveon.dto.EmployeeAccountVO">
        UPDATE employee
        <set>
            name = #{name, jdbcType=VARCHAR},
            deptName = #{deptName, jdbcType=VARCHAR},
            ppsName = #{ppsName, jdbcType=VARCHAR},
            job = #{job, jdbcType=VARCHAR},
            authorities = #{role, jdbcType=VARCHAR},
            phone = #{phone, jdbcType=VARCHAR},
            joindate = #{joinDate, jdbcType=DATE},
            leavedate = #{leaveDate, jdbcType=DATE},
            enabled = #{enabled, jdbcType=INTEGER}
        </set>
        WHERE eno = #{empNo, jdbcType=INTEGER}
    </update>

    <!-- 계정 삭제 -->
    <delete id="deleteAccount" parameterType="Integer">
        DELETE FROM employee WHERE eno = #{empNo, jdbcType=INTEGER}
    </delete>

</mapper>