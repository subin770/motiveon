<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Popup-Mapper">
	
    <!-- 팝업 목록 조회 -->
	<select id="selectSearchPopupList" parameterType="map" resultType="popup">
		SELECT popNo, title, content, deadLine, enabled 
		FROM PopUp 
		WHERE 1=1
		<if test="title != null and title != ''"> 
			AND title LIKE '%' || #{title} || '%' 
		</if>
		<if test="enabled != null"> 
			AND enabled = #{enabled} 
		</if>
		ORDER BY popNo DESC
	</select> 
	
    <!-- 팝업 등록 --> 
<insert id="insertPopup" parameterType="com.motiveon.dto.PopUpVO">
    INSERT INTO POPUP (POPNO, TITLE, CONTENT)
    VALUES (#{popNo, jdbcType=VARCHAR}, #{title, jdbcType=VARCHAR}, #{content, jdbcType=VARCHAR})
</insert>

    <!-- 팝업 상세 조회 -->
	<select id="selectPopupByPopNo" parameterType="string" resultType="popup"> 
		SELECT popNo, title, content, deadLine, enabled 
		FROM PopUp
		WHERE popNo = #{popNo}
	</select> 
	
    <!-- 팝업 수정 -->
	<update id="updatePopup" parameterType="popup"> 
		UPDATE PopUp 
		SET title = #{title}, content = #{content}, enabled = #{enabled} 
		WHERE popNo = #{popNo}
	</update> 
	
    <!-- 팝업 삭제 -->
	<delete id="deletePopup" parameterType="string"> 
		DELETE FROM PopUp WHERE popNo = #{popNo}
	</delete>
	
    <!-- 첨부파일 등록 -->
	<insert id="insertAttachment" parameterType="com.motiveon.dto.AttachmentVO">
		INSERT INTO ATTACHMENT
		(ANO, UPLOADPATH, FILENAME, FILETYPE, PNO, ATTACHER, REGDATE)
		VALUES (ATTACHMENT_SEQ.NEXTVAL, #{uploadPath}, #{fileName}, #{fileType}, #{popNo}, #{attacher}, SYSDATE)
	</insert>

    <!-- 첨부파일 조회 -->
	<select id="selectAttachmentsByPopNo" parameterType="int" resultType="com.motiveon.dto.AttachmentVO">
		SELECT ANO, UPLOADPATH, FILENAME, FILETYPE, PNO, ATTACHER, REGDATE
		FROM ATTACHMENT
		WHERE PNO = #{popNo}
		ORDER BY REGDATE DESC
	</select>

</mapper>